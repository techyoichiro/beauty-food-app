import OpenAI from 'openai';

// OpenAI APIã‚­ãƒ¼ï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
const OPENAI_API_KEY = process.env.EXPO_PUBLIC_OPENAI_API_KEY;

if (!OPENAI_API_KEY || OPENAI_API_KEY === 'your-api-key-here') {
  throw new Error('Missing OpenAI API key. Please check your .env file.');
}

// OpenAIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–
export const openai = new OpenAI({
  apiKey: OPENAI_API_KEY,
  dangerouslyAllowBrowser: true, // React Native/Expoã§å¿…è¦
});

// ç¾å®¹ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã®è©³ç´°æƒ…å ±
const BEAUTY_CATEGORY_DETAILS = {
  skin_care: {
    name: 'ç¾è‚Œ',
    focus: 'ã‚³ãƒ©ãƒ¼ã‚²ãƒ³ç”Ÿæˆã€ãƒ“ã‚¿ãƒŸãƒ³Cãƒ»Eã€æŠ—é…¸åŒ–ç‰©è³ªã€ã‚»ãƒ©ãƒŸãƒ‰ã€ãƒ’ã‚¢ãƒ«ãƒ­ãƒ³é…¸ã®ææ–™',
    keywords: ['ãƒ“ã‚¿ãƒŸãƒ³C', 'ãƒ“ã‚¿ãƒŸãƒ³E', 'ã‚³ãƒ©ãƒ¼ã‚²ãƒ³', 'ã‚¢ã‚¹ã‚¿ã‚­ã‚µãƒ³ãƒãƒ³', 'ãƒªã‚³ãƒ”ãƒ³', 'ãƒ™ãƒ¼ã‚¿ã‚«ãƒ­ãƒ†ãƒ³'],
    adviceStyle: 'è‚Œã®ãƒãƒªãƒ»ãƒ„ãƒ¤ãƒ»é€æ˜æ„Ÿã‚’é‡è¦–ã—ãŸé£Ÿæçµ„ã¿åˆã‚ã›'
  },
  anti_aging: {
    name: 'ã‚¢ãƒ³ãƒã‚¨ã‚¤ã‚¸ãƒ³ã‚°',
    focus: 'æ´»æ€§é…¸ç´ é™¤å»ã€æŠ—é…¸åŒ–ä½œç”¨ã€ç´°èƒä¿®å¾©ã€DNAä¿è­·ã€è€åŒ–é˜²æ­¢',
    keywords: ['ãƒãƒªãƒ•ã‚§ãƒãƒ¼ãƒ«', 'ã‚«ãƒ†ã‚­ãƒ³', 'ã‚¢ãƒ³ãƒˆã‚·ã‚¢ãƒ‹ãƒ³', 'ãƒ¬ã‚¹ãƒ™ãƒ©ãƒˆãƒ­ãƒ¼ãƒ«', 'ã‚»ã‚µãƒŸãƒ³', 'ã‚¯ãƒ«ã‚¯ãƒŸãƒ³'],
    adviceStyle: 'ç´°èƒãƒ¬ãƒ™ãƒ«ã§ã®è€åŒ–é˜²æ­¢ã¨ä¿®å¾©ã‚’é‡è¦–ã—ãŸæ „é¤Šç´ '
  },
  detox: {
    name: 'ãƒ‡ãƒˆãƒƒã‚¯ã‚¹',
    focus: 'è‚æ©Ÿèƒ½ã‚µãƒãƒ¼ãƒˆã€è…¸å†…ç’°å¢ƒæ”¹å–„ã€è€å»ƒç‰©æ’å‡ºã€æ°´åˆ†ä»£è¬ä¿ƒé€²',
    keywords: ['é£Ÿç‰©ç¹Šç¶­', 'ã‚«ãƒªã‚¦ãƒ ', 'ã‚°ãƒ«ã‚¿ãƒã‚ªãƒ³', 'ç¡«é»„åŒ–åˆç‰©', 'ä¹³é…¸èŒ', 'ã‚ªãƒªã‚´ç³–'],
    adviceStyle: 'ä½“å†…æµ„åŒ–ã¨ä»£è¬ä¿ƒé€²ã‚’é‡è¦–ã—ãŸé£Ÿæé¸æŠ'
  },
  circulation: {
    name: 'è¡€è¡Œä¿ƒé€²',
    focus: 'è¡€æµæ”¹å–„ã€å†·ãˆæ€§æ”¹å–„ã€é…¸ç´ ãƒ»æ „é¤Šç´ ã®é‹æ¬åŠ¹ç‡å‘ä¸Š',
    keywords: ['é‰„åˆ†', 'ãƒ“ã‚¿ãƒŸãƒ³E', 'ãƒŠã‚¤ã‚¢ã‚·ãƒ³', 'ã‚«ãƒ—ã‚µã‚¤ã‚·ãƒ³', 'ã‚·ãƒ§ã‚¦ã‚¬ã‚ªãƒ¼ãƒ«', 'EPAãƒ»DHA'],
    adviceStyle: 'è¡€æµã¨ä½“æ¸©å‘ä¸Šã‚’é‡è¦–ã—ãŸæ¸©æ´»é£Ÿæ'
  },
  hair_nails: {
    name: 'é«ªãƒ»çˆªã®å¥åº·',
    focus: 'ã‚±ãƒ©ãƒãƒ³ç”Ÿæˆã€ã‚¿ãƒ³ãƒ‘ã‚¯è³ªåˆæˆã€ãƒŸãƒãƒ©ãƒ«è£œçµ¦ã€æ¯›é«ªæˆé•·ä¿ƒé€²',
    keywords: ['ã‚¿ãƒ³ãƒ‘ã‚¯è³ª', 'äºœé‰›', 'ãƒ“ã‚ªãƒãƒ³', 'ã‚·ã‚¹ãƒãƒ³', 'ãƒ¡ãƒã‚ªãƒ‹ãƒ³', 'ã‚±ã‚¤ç´ '],
    adviceStyle: 'é«ªã¨çˆªã®æ§‹é€ ææ–™ã¨ãªã‚‹æ „é¤Šç´ ã‚’é‡è¦–'
  }
};

// ç¾å®¹ã‚¹ã‚¿ã‚¤ãƒ«åˆ¥ã®èª¬æ˜æ·±åº¦
const BEAUTY_LEVEL_STYLES = {
  beginner: {
    name: 'åˆå¿ƒè€…',
    style: 'ã‚ã‹ã‚Šã‚„ã™ãç°¡æ½”ã«ã€åŸºæœ¬çš„ãªæ „é¤Šç´ ã®åŠ¹æœã‚’èª¬æ˜',
    example: 'ã€Œãƒ“ã‚¿ãƒŸãƒ³Cã¯ç¾è‚Œã«è‰¯ã„ã€'
  },
  intermediate: {
    name: 'ä¸­ç´šè€…',
    style: 'æ „é¤Šç´ ã®å…·ä½“çš„ãªåƒãã¨ç¾å®¹åŠ¹æœã®é–¢é€£ã‚’èª¬æ˜',
    example: 'ã€Œãƒ“ã‚¿ãƒŸãƒ³Cã¯ã‚³ãƒ©ãƒ¼ã‚²ãƒ³åˆæˆã‚’ä¿ƒé€²ã—ã€è‚Œã®ãƒãƒªã‚’ä¿ã¤ã€'
  },
  advanced: {
    name: 'ä¸Šç´šè€…',
    style: 'ç”ŸåŒ–å­¦çš„ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã¨ç§‘å­¦çš„æ ¹æ‹ ã‚’å«ã‚€è©³ç´°èª¬æ˜',
    example: 'ã€Œã‚¢ã‚¹ã‚³ãƒ«ãƒ“ãƒ³é…¸ãŒãƒ—ãƒ­ãƒªãƒ³ãƒ»ãƒªã‚¸ãƒ³ã®æ°´é…¸åŒ–ã‚’ä¿ƒé€²ã—ã‚³ãƒ©ãƒ¼ã‚²ãƒ³ä¸‰é‡ã‚‰ã›ã‚“æ§‹é€ ã‚’å®‰å®šåŒ–ã€'
  }
};

// ç¾å®¹ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
const generateCategorySpecificAdvice = (categories: string[], level: string) => {
  const selectedCategories = categories.map(cat => BEAUTY_CATEGORY_DETAILS[cat as keyof typeof BEAUTY_CATEGORY_DETAILS]).filter(Boolean);
  const levelInfo = BEAUTY_LEVEL_STYLES[level as keyof typeof BEAUTY_LEVEL_STYLES] || BEAUTY_LEVEL_STYLES.intermediate;

  const focusAreas = selectedCategories.map(cat => cat.focus).join('ã€');
  const keywords = selectedCategories.flatMap(cat => cat.keywords).join('ã€');
  const adviceStyles = selectedCategories.map(cat => cat.adviceStyle).join('ã€');

  return {
    focusAreas,
    keywords,
    adviceStyles,
    levelStyle: levelInfo.style,
    categoryNames: selectedCategories.map(cat => cat.name).join('ãƒ»')
  };
};

// é£Ÿäº‹è§£æç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
export const createFoodAnalysisPrompt = (userProfile: {
  beautyCategories: string[];
  beautyLevel: string;
}) => {
  const categoryInfo = generateCategorySpecificAdvice(userProfile.beautyCategories, userProfile.beautyLevel);
  
  return `
ã“ã®é£Ÿäº‹ç”»åƒã‚’è©³ç´°ã«åˆ†æã—ã¦ã€ä»¥ä¸‹ã®JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

ã€é£Ÿææ¤œå‡ºã®é‡è¦æŒ‡é‡ã€‘
1. å…·ä½“çš„ãªé£Ÿæåã‚’ç‰¹å®šã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€Œé­šã€â†’ã€Œã‚µãƒã€ã€Œé®­ã€ã€Œãƒã‚°ãƒ­ã€ãªã©ï¼‰
2. é‡èœã¯ç¨®é¡ã‚’è©³ã—ãåˆ†æã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€Œé‡èœã€â†’ã€Œç‰ã­ãã€ã€Œäººå‚ã€ã€Œãƒ”ãƒ¼ãƒãƒ³ã€ãªã©ï¼‰
3. èª¿ç†æ³•ã‚„æ–™ç†åã‚‚è€ƒæ…®ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€Œã‚«ãƒ¬ãƒ¼ã€ã€Œç‚’ã‚ç‰©ã€ã€Œç…®ç‰©ã€ãªã©ï¼‰
4. é¦™è¾›æ–™ã‚„ã‚½ãƒ¼ã‚¹ã€èª¿å‘³æ–™ã‚‚å¯èƒ½ãªé™ã‚Šæ¤œå‡ºã—ã¦ãã ã•ã„
5. éƒ¨åˆ†çš„ã«è¦‹ãˆã‚‹é£Ÿæã‚‚æ¨æ¸¬ã—ã¦å«ã‚ã¦ãã ã•ã„
6. ä¿¡é ¼åº¦ã¯æ§ãˆã‚ã«è¨­å®šã—ã€ä¸ç¢ºå®Ÿãªå ´åˆã¯0.6-0.8ç¨‹åº¦ã«ã—ã¦ãã ã•ã„
7. æ–™ç†ã®æ–‡åŒ–çš„èƒŒæ™¯ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã‚¹ãƒªãƒ©ãƒ³ã‚«ã‚«ãƒ¬ãƒ¼ã€ã‚¿ã‚¤æ–™ç†ã€ã‚¤ã‚¿ãƒªã‚¢æ–™ç†ãªã©ï¼‰
8. å…¸å‹çš„ãªçµ„ã¿åˆã‚ã›ã®é£Ÿæã‚‚æ¨æ¸¬ã—ã¦å«ã‚ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã‚«ãƒ¬ãƒ¼ãªã‚‰ã‚³ã‚³ãƒŠãƒƒãƒ„ãƒŸãƒ«ã‚¯ã€ã‚¬ãƒ©ãƒ ãƒã‚µãƒ©ãªã©ï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«:
- ç¾å®¹ç›®æ¨™: ${categoryInfo.categoryNames}
- ç¾å®¹ãƒ¬ãƒ™ãƒ«: ${BEAUTY_LEVEL_STYLES[userProfile.beautyLevel as keyof typeof BEAUTY_LEVEL_STYLES]?.name || 'ä¸­ç´šè€…'}
- é‡ç‚¹ãƒ•ã‚©ãƒ¼ã‚«ã‚¹: ${categoryInfo.focusAreas}

ã€é‡è¦ã€‘ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆã®æŒ‡é‡:
1. èª¬æ˜ãƒ¬ãƒ™ãƒ«: ${categoryInfo.levelStyle}
2. é‡è¦–ã™ã‚‹æ „é¤Šç´ : ${categoryInfo.keywords}
3. ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«: ${categoryInfo.adviceStyles}

ä»¥ä¸‹ã®JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„:

{
  "detected_foods": [
    {
      "name": "å…·ä½“çš„ãªé£Ÿæåï¼ˆä¾‹ï¼šé®­ã®åˆ‡ã‚Šèº«ã€ç‰ã­ãã€ã‚³ã‚³ãƒŠãƒƒãƒ„ãƒŸãƒ«ã‚¯ã€ã‚¿ãƒ¼ãƒ¡ãƒªãƒƒã‚¯ç­‰ï¼‰",
      "category": "protein|carb|vegetable|fruit|fat|spice|sauce|other",
      "estimated_amount": "æ¨å®šé‡ï¼ˆä¾‹ï¼š100gã€1å€‹ã€å¤§ã•ã˜1ï¼‰",
      "confidence": 0.75
    }
  ],
  "nutrition_analysis": {
    "calories": æ¨å®šã‚«ãƒ­ãƒªãƒ¼æ•°å€¤,
    "protein": ã‚¿ãƒ³ãƒ‘ã‚¯è³ª(g),
    "carbohydrates": ç‚­æ°´åŒ–ç‰©(g),
    "fat": è„‚è³ª(g),
    "fiber": é£Ÿç‰©ç¹Šç¶­(g),
    "vitamins": {
      "vitamin_c": ãƒ“ã‚¿ãƒŸãƒ³C(mg),
      "vitamin_e": ãƒ“ã‚¿ãƒŸãƒ³E(mg),
      "vitamin_a": ãƒ“ã‚¿ãƒŸãƒ³A(Î¼g),
      "vitamin_b_complex": ãƒ“ã‚¿ãƒŸãƒ³Bç¾¤ç·åˆã‚¹ã‚³ã‚¢(1-10)
    },
    "minerals": {
      "iron": é‰„åˆ†(mg),
      "zinc": äºœé‰›(mg),
      "calcium": ã‚«ãƒ«ã‚·ã‚¦ãƒ (mg),
      "magnesium": ãƒã‚°ãƒã‚·ã‚¦ãƒ (mg)
    }
  },
  "beauty_score": {
    "skin_care": ç¾è‚Œã‚¹ã‚³ã‚¢(0-100),
    "anti_aging": ã‚¢ãƒ³ãƒã‚¨ã‚¤ã‚¸ãƒ³ã‚°ã‚¹ã‚³ã‚¢(0-100),
    "detox": ãƒ‡ãƒˆãƒƒã‚¯ã‚¹ã‚¹ã‚³ã‚¢(0-100),
    "circulation": è¡€è¡Œä¿ƒé€²ã‚¹ã‚³ã‚¢(0-100),
    "hair_nails": é«ªãƒ»çˆªå¥åº·ã‚¹ã‚³ã‚¢(0-100),
    "overall": ç·åˆç¾å®¹ã‚¹ã‚³ã‚¢(0-100)
  },
  "immediate_advice": "ä»Šã™ãã§ãã‚‹æ”¹å–„ææ¡ˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾å®¹ç›®æ¨™ã€Œ${categoryInfo.categoryNames}ã€ã«ç‰¹åŒ–ï¼‰",
  "next_meal_advice": "æ¬¡å›å‘ã‘æ”¹å–„ææ¡ˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾å®¹ç›®æ¨™ã€Œ${categoryInfo.categoryNames}ã€ã«ç‰¹åŒ–ï¼‰",
  "beauty_benefits": [
    "ä»Šå›ã®é£Ÿäº‹ã§æœŸå¾…ã§ãã‚‹ç¾å®¹åŠ¹æœ1ï¼ˆ${categoryInfo.categoryNames}è¦³ç‚¹ï¼‰",
    "ä»Šå›ã®é£Ÿäº‹ã§æœŸå¾…ã§ãã‚‹ç¾å®¹åŠ¹æœ2ï¼ˆ${categoryInfo.categoryNames}è¦³ç‚¹ï¼‰",
    "ä»Šå›ã®é£Ÿäº‹ã§æœŸå¾…ã§ãã‚‹ç¾å®¹åŠ¹æœ3ï¼ˆ${categoryInfo.categoryNames}è¦³ç‚¹ï¼‰"
  ]
}

ã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆã®é‡è¦åŸå‰‡ã€‘
1. åŒã˜æ „é¤Šç´ ã§ã‚‚å¤šæ§˜ãªé£Ÿæãƒ»æ–¹æ³•ã‚’ææ¡ˆã™ã‚‹
2. ç¾åœ¨ã®é£Ÿäº‹ã«å«ã¾ã‚Œã‚‹é£Ÿæã‚’æ´»ã‹ã—ãŸææ¡ˆã‚’ã™ã‚‹
3. å­£ç¯€ã‚„æ™‚é–“å¸¯ã‚’è€ƒæ…®ã—ãŸå®Ÿç”¨çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹
4. ãƒ¯ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¿ã‘ã€ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³è±Šã‹ãªææ¡ˆã‚’ã™ã‚‹

ã€æ „é¤Šç´ åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ä¾‹ã€‘
ãƒ“ã‚¿ãƒŸãƒ³Cä¸è¶³ã®å ´åˆï¼ˆãƒ¬ãƒ¢ãƒ³ä»¥å¤–ã®å¤šæ§˜ãªææ¡ˆï¼‰:
- "ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ã‚’è’¸ã—é‡èœã§è¿½åŠ ï¼ãƒ“ã‚¿ãƒŸãƒ³CãŒãƒ¬ãƒ¢ãƒ³ã®2å€å«ã¾ã‚Œã¦ã„ã¾ã™"
- "ã„ã¡ã”ã‚’3-4å€‹ãƒ‡ã‚¶ãƒ¼ãƒˆã«ã€‚ç”˜ã¿ã¨ãƒ“ã‚¿ãƒŸãƒ³Cã‚’åŒæ™‚ã«æ‘‚å–ã§ãã¾ã™"
- "ãƒ‘ãƒ—ãƒªã‚«ï¼ˆèµ¤ãƒ»é»„ï¼‰ã‚’ã‚µãƒ©ãƒ€ã«è¿½åŠ ã€‚è‰²é®®ã‚„ã‹ã§ãƒ“ã‚¿ãƒŸãƒ³Cè±Šå¯Œï¼"
- "ã‚­ã‚¦ã‚¤ãƒ•ãƒ«ãƒ¼ãƒ„1å€‹ã§1æ—¥åˆ†ã®ãƒ“ã‚¿ãƒŸãƒ³Cã€‚é£Ÿå¾Œã®ãƒ‡ã‚¶ãƒ¼ãƒˆã«æœ€é©"
- "èŠ½ã‚­ãƒ£ãƒ™ãƒ„ã‚’ç‚’ã‚ç‰©ã«ã€‚å°ã•ãã¦ã‚‚æ „é¤Šä¾¡ã¯æŠœç¾¤ã§ã™"
- "ã‚´ãƒ¼ãƒ¤ãƒãƒ£ãƒ³ãƒ—ãƒ«ãƒ¼ã§è‹¦å‘³ã¨ãƒ“ã‚¿ãƒŸãƒ³Cã‚’ã€‚æ²–ç¸„ã®ç¾å®¹é£Ÿæ"
- "ãƒ­ãƒ¼ã‚ºãƒ’ãƒƒãƒ—ãƒ†ã‚£ãƒ¼ã§æ¸©æ´»ã—ãªãŒã‚‰ãƒ“ã‚¿ãƒŸãƒ³Cè£œçµ¦"

ã‚¿ãƒ³ãƒ‘ã‚¯è³ªä¸è¶³ã®å ´åˆï¼ˆåµä»¥å¤–ã®å¤šæ§˜ãªææ¡ˆï¼‰:
- "ç´è±†ã‚’è¿½åŠ ã—ã¦æ¤ç‰©æ€§ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã¨ç™ºé…µãƒ‘ãƒ¯ãƒ¼ã‚’ãƒ—ãƒ©ã‚¹"
- "ã‚®ãƒªã‚·ãƒ£ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆã§ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã¨ä¹³é…¸èŒã‚’åŒæ™‚æ‘‚å–"
- "è±†è…ãƒãƒ³ãƒãƒ¼ã‚°ã§ä½ã‚«ãƒ­ãƒªãƒ¼ãƒ»é«˜ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®ç¾å®¹é£Ÿ"
- "ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ãƒã‚¿ãƒ¼ã‚’ãƒ‘ãƒ³ã«å¡—ã£ã¦æ¤ç‰©æ€§ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’"
- "ã•ã•ã¿ã®ã‚µãƒ©ãƒ€ãƒã‚­ãƒ³ã§ä½è„‚è³ªãƒ»é«˜ã‚¿ãƒ³ãƒ‘ã‚¯è³ª"
- "ãƒ¬ãƒ³ã‚ºè±†ã®ã‚¹ãƒ¼ãƒ—ã§é£Ÿç‰©ç¹Šç¶­ã¨ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’åŒæ™‚ã«"

é‰„åˆ†ä¸è¶³ã®å ´åˆï¼ˆã»ã†ã‚Œã‚“è‰ä»¥å¤–ã®å¤šæ§˜ãªææ¡ˆï¼‰:
- "ã‚ã•ã‚Šã®å‘³å™Œæ±ã§é‰„åˆ†ã¨ãƒ“ã‚¿ãƒŸãƒ³B12ã‚’åŒæ™‚æ‘‚å–"
- "ã²ã˜ãã®ç…®ç‰©ã§æµ·è—»ãƒŸãƒãƒ©ãƒ«ã¨é‰„åˆ†ã‚’è£œçµ¦"
- "ãƒ¬ãƒãƒ¼ãƒšãƒ¼ã‚¹ãƒˆã‚’ã‚¯ãƒ©ãƒƒã‚«ãƒ¼ã«ã€‚é‰„åˆ†ã®ç‹æ§˜ã§ã™"
- "ãƒ—ãƒ«ãƒ¼ãƒ³ã‚’3å€‹é–“é£Ÿã«ã€‚è‡ªç„¶ãªç”˜ã¿ã¨é‰„åˆ†è£œçµ¦"
- "ç‰›èµ¤èº«è‚‰ã®ã‚¹ãƒ†ãƒ¼ã‚­ã§å¸åç‡ã®é«˜ã„ãƒ˜ãƒ é‰„ã‚’"
- "ã‹ã¤ãŠã®ãŸãŸãã§é‰„åˆ†ã¨DHAã‚’åŒæ™‚ã«"

ã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆã®å…·ä½“ä¾‹ã€‘
ç¾è‚Œé‡è¦–ã®å ´åˆ:
- immediate_advice: "ãƒ‘ãƒ—ãƒªã‚«ã‚’è¿½åŠ ã—ã¦å½©ã‚Šã‚¢ãƒƒãƒ—ï¼ãƒ“ã‚¿ãƒŸãƒ³CãŒãƒ¬ãƒ¢ãƒ³ã®3å€ã§ç¾è‚ŒåŠ¹æœæŠœç¾¤"
- next_meal_advice: "æ¬¡å›ã¯ã‚¢ãƒœã‚«ãƒ‰ãƒˆãƒ¼ã‚¹ãƒˆã‚’ã€‚ãƒ“ã‚¿ãƒŸãƒ³Eã§è‚Œã®æ½¤ã„ã‚’å†…å´ã‹ã‚‰"

ã‚¢ãƒ³ãƒã‚¨ã‚¤ã‚¸ãƒ³ã‚°é‡è¦–ã®å ´åˆ:
- immediate_advice: "ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼ã‚’ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼ã‚¢ãƒ³ãƒˆã‚·ã‚¢ãƒ‹ãƒ³ã§æ´»æ€§é…¸ç´ ã‚’æ’ƒé€€"
- next_meal_advice: "æ˜æ—¥ã¯ãã‚‹ã¿ã‚’é–“é£Ÿã«ã€‚ã‚ªãƒ¡ã‚¬3è„‚è‚ªé…¸ã§è„³ã¨è‚Œã®è€åŒ–é˜²æ­¢"

ãƒ‡ãƒˆãƒƒã‚¯ã‚¹é‡è¦–ã®å ´åˆ:
- immediate_advice: "å¤§æ ¹ãŠã‚ã—ã‚’æ·»ãˆã¦æ¶ˆåŒ–é…µç´ ã‚’ãƒ—ãƒ©ã‚¹ï¼ä»£è¬ã‚¢ãƒƒãƒ—ã§è€å»ƒç‰©æ’å‡º"
- next_meal_advice: "æ¬¡å›ã¯ã‚ã‹ã‚ã‚¹ãƒ¼ãƒ—ã‚’ã€‚æµ·è—»ã®é£Ÿç‰©ç¹Šç¶­ã§è…¸å†…ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°"

è¡€è¡Œä¿ƒé€²é‡è¦–ã®å ´åˆ:
- immediate_advice: "ã‚·ãƒŠãƒ¢ãƒ³ãƒ‘ã‚¦ãƒ€ãƒ¼ã‚’ãµã‚Šã‹ã‘ã¦è¡€è¡Œä¿ƒé€²ï¼ä½“ãŒãƒã‚«ãƒã‚«æ¸©ã¾ã‚Šã¾ã™"
- next_meal_advice: "æ¬¡å›ã¯ã«ã‚“ã«ãã‚’åŠ¹ã‹ã›ãŸæ–™ç†ã‚’ã€‚è¡€æ¶²ã‚µãƒ©ã‚µãƒ©åŠ¹æœã§ç¾è‚Œã«"

é«ªãƒ»çˆªé‡è¦–ã®å ´åˆ:
- immediate_advice: "ã‚¢ãƒ¼ãƒ¢ãƒ³ãƒ‰ã‚¹ãƒ©ã‚¤ã‚¹ã‚’ãƒˆãƒƒãƒ”ãƒ³ã‚°ï¼ãƒ“ã‚¿ãƒŸãƒ³Eã§é«ªã«ãƒ„ãƒ¤ã‚’"
- next_meal_advice: "æ¬¡å›ã¯ç‰¡è £ã‚’ä½¿ã£ãŸæ–™ç†ã‚’ã€‚äºœé‰›ã§é«ªã®æˆé•·ã‚’ä¿ƒé€²ã—ã¾ã—ã‚‡ã†"

ã€æ™‚é–“å¸¯ãƒ»å­£ç¯€åˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ä¾‹ã€‘
æœé£Ÿæ™‚ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:
- "æœã®ãƒ“ã‚¿ãƒŸãƒ³Cè£œçµ¦ã«ã¯ã‚°ãƒ¬ãƒ¼ãƒ—ãƒ•ãƒ«ãƒ¼ãƒ„ãŒãŠã™ã™ã‚ã€‚ç›®è¦šã‚ã‚‚ã‚¹ãƒƒã‚­ãƒªï¼"
- "æœé£Ÿã«ãƒ™ãƒªãƒ¼é¡ã‚’ãƒ—ãƒ©ã‚¹ã€‚æŠ—é…¸åŒ–ä½œç”¨ã§1æ—¥ã®ç¾å®¹ã‚’ã‚µãƒãƒ¼ãƒˆ"

æ˜¼é£Ÿæ™‚ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:
- "ãƒ©ãƒ³ãƒã«ã¯ãƒˆãƒãƒˆã‚µãƒ©ãƒ€ã‚’ã€‚ãƒªã‚³ãƒ”ãƒ³ã¯æ˜¼é–“ã®ç´«å¤–ç·šå¯¾ç­–ã«åŠ¹æœçš„"
- "ãŠæ˜¼ã«ã¯ç·‘é»„è‰²é‡èœã‚’ã€‚åˆå¾Œã®æ´»å‹•ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¨ç¾å®¹åŠ¹æœã‚’ä¸¡ç«‹"

å¤•é£Ÿæ™‚ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:
- "å¤œã¯æ¶ˆåŒ–ã®è‰¯ã„ã‚¢ãƒœã‚«ãƒ‰ã‚’ã€‚è‰¯è³ªãªè„‚è³ªã§å¤œé–“ã®è‚Œä¿®å¾©ã‚’ã‚µãƒãƒ¼ãƒˆ"
- "å¤•é£Ÿå¾Œã«ã¯ãƒãƒ¼ãƒ–ãƒ†ã‚£ãƒ¼ã€‚ãƒªãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœã¨ç¾å®¹åŠ¹æœã‚’åŒæ™‚ã«"

æ˜¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:
- "æ˜¥ã‚­ãƒ£ãƒ™ãƒ„ã§ãƒ‡ãƒˆãƒƒã‚¯ã‚¹ï¼æ–°é™³ä»£è¬ã‚’é«˜ã‚ã¦ç¾è‚Œã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†"
- "ãŸã‘ã®ã“ã§é£Ÿç‰©ç¹Šç¶­è£œçµ¦ã€‚æ˜¥ã®ä½“å†…ãƒªã‚»ãƒƒãƒˆã«æœ€é©ã§ã™"

å¤ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:
- "å¤é‡èœã®ãƒˆãƒãƒˆã§ç´«å¤–ç·šå¯¾ç­–ï¼ãƒªã‚³ãƒ”ãƒ³ãŒè‚Œã‚’å†…å´ã‹ã‚‰å®ˆã‚Šã¾ã™"
- "ãã‚…ã†ã‚Šã§æ°´åˆ†è£œçµ¦ã¨ç¾è‚ŒåŠ¹æœã€‚å¤ã®å®šç•ªç¾å®¹é£Ÿæã§ã™"

ç§‹ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:
- "ç§‹é®­ã§ã‚¢ã‚¹ã‚¿ã‚­ã‚µãƒ³ãƒãƒ³è£œçµ¦ï¼å­£ç¯€ã®å¤‰ã‚ã‚Šç›®ã®è‚Œè’ã‚Œå¯¾ç­–ã«"
- "ã‹ã¼ã¡ã‚ƒã§Î²ã‚«ãƒ­ãƒ†ãƒ³æ‘‚å–ã€‚ç§‹ã®ä¹¾ç‡¥è‚Œå¯¾ç­–ã«åŠ¹æœçš„"

å†¬ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹:
- "å†¬ã®æ ¹èœã§ä½“ã‚’æ¸©ã‚ã¦è¡€è¡Œä¿ƒé€²ã€‚ç¾è‚ŒåŠ¹æœã‚‚ã‚¢ãƒƒãƒ—ã—ã¾ã™"
- "ã¿ã‹ã‚“ã§ãƒ“ã‚¿ãƒŸãƒ³Cè£œçµ¦ã€‚å†¬ã®ä¹¾ç‡¥ã¨é¢¨é‚ªäºˆé˜²ã«ä¸€çŸ³äºŒé³¥"

ã€é£Ÿææ¤œå‡ºã®å…·ä½“ä¾‹ã€‘
ã‚«ãƒ¬ãƒ¼æ–™ç†ã®å ´åˆ:
- âŒ æ‚ªã„ä¾‹: "é­š", "é‡èœ", "ã”é£¯", "ã‚¹ãƒ¼ãƒ—"
- âœ… è‰¯ã„ä¾‹: "ãƒã‚°ãƒ­ã®åˆºèº«", "ç‰ã­ã", "äººå‚", "ãƒ”ãƒ¼ãƒãƒ³", "ã‚³ã‚³ãƒŠãƒƒãƒ„ãƒŸãƒ«ã‚¯", "ã‚¿ãƒ¼ãƒ¡ãƒªãƒƒã‚¯", "ã‚¯ãƒŸãƒ³", "ã‚³ãƒªã‚¢ãƒ³ãƒ€ãƒ¼", "ã‚¬ãƒ©ãƒ ãƒã‚µãƒ©", "ãƒã‚¹ãƒãƒ†ã‚£ãƒ©ã‚¤ã‚¹", "ã‚«ãƒ¬ãƒ¼ãƒ«ãƒ¼"

ã‚µãƒ©ãƒ€ã®å ´åˆ:
- âŒ æ‚ªã„ä¾‹: "é‡èœ", "ãƒ‰ãƒ¬ãƒƒã‚·ãƒ³ã‚°"
- âœ… è‰¯ã„ä¾‹: "ãƒ¬ã‚¿ã‚¹", "ãƒˆãƒãƒˆ", "ãã‚…ã†ã‚Š", "ã‚¢ãƒœã‚«ãƒ‰", "ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«", "ãƒãƒ«ã‚µãƒŸã‚³é…¢", "ãƒ‘ãƒ«ãƒ¡ã‚¶ãƒ³ãƒãƒ¼ã‚º", "ã‚¯ãƒ«ãƒˆãƒ³"

é‡è¦äº‹é …:
- æœ‰åŠ¹ãªJSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„
- æ—¥æœ¬èªã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚ã¦ãã ã•ã„
- æ•°å€¤ã¯å…·ä½“çš„ã«ç®—å‡ºã—ã¦ãã ã•ã„
- ç¾å®¹ã‚¹ã‚³ã‚¢ã¯ç§‘å­¦çš„æ ¹æ‹ ã«åŸºã¥ã„ã¦ç®—å‡ºã—ã¦ãã ã•ã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾å®¹ç›®æ¨™ã«ç‰¹åŒ–ã—ãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„
- èª¬æ˜ãƒ¬ãƒ™ãƒ«ã¯ã€Œ${categoryInfo.levelStyle}ã€ã«åˆã‚ã›ã¦ãã ã•ã„
- beauty_benefitsã¯ã€Œä»Šå›ã®é£Ÿäº‹ã‚’æ‘‚å–ã™ã‚‹ã“ã¨ã§æœŸå¾…ã§ãã‚‹å…·ä½“çš„ãªç¾å®¹åŠ¹æœã€ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„
- ç¾å®¹åŠ¹æœã¯çŸ­æœŸçš„ï¼ˆæ•°æ™‚é–“ã€œæ•°æ—¥ï¼‰ã§å®Ÿæ„Ÿã§ãã‚‹ã‚‚ã®ã¨ä¸­é•·æœŸçš„ï¼ˆæ•°é€±é–“ã€œæ•°ãƒ¶æœˆï¼‰ãªã‚‚ã®ã®ä¸¡æ–¹ã‚’å«ã‚ã¦ãã ã•ã„
- é£Ÿæåã¯å¯èƒ½ãªé™ã‚Šå…·ä½“çš„ã«ç‰¹å®šã—ã¦ãã ã•ã„ï¼ˆæ›–æ˜§ãªã€Œé­šã€ã€Œé‡èœã€ã§ã¯ãªãã€Œã‚µãƒã€ã€Œç‰ã­ãã€ãªã©ï¼‰

ã€ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆã®å¿…é ˆãƒ«ãƒ¼ãƒ«ã€‘
- åŒã˜æ „é¤Šç´ ã§ã‚‚æ¯å›ç•°ãªã‚‹é£Ÿæã‚’ææ¡ˆã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šãƒ“ã‚¿ãƒŸãƒ³C â†’ ãƒ¬ãƒ¢ãƒ³ã€ãƒ‘ãƒ—ãƒªã‚«ã€ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ã€ã‚­ã‚¦ã‚¤ãªã©ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- ç¾åœ¨ã®é£Ÿäº‹å†…å®¹ã‚’åˆ†æã—ã€æ—¢ã«å«ã¾ã‚Œã‚‹é£Ÿæã¨ç›¸æ€§ã®è‰¯ã„ææ¡ˆã‚’ã—ã¦ãã ã•ã„
- ã€Œãƒ¬ãƒ¢ãƒ³ã‚’çµã‚‹ã€ã€Œç·‘èŒ¶ã‚’é£²ã‚€ã€ãªã©ã®å®šç•ªãƒ•ãƒ¬ãƒ¼ã‚ºã‚’é¿ã‘ã€å¤šæ§˜ãªè¡¨ç¾ã‚’ä½¿ã£ã¦ãã ã•ã„
- å­£ç¯€æ„Ÿã®ã‚ã‚‹é£Ÿæã‚„ã€æ™‚é–“å¸¯ã«é©ã—ãŸææ¡ˆã‚’å¿ƒãŒã‘ã¦ãã ã•ã„
- å®Ÿç”¨æ€§ã‚’é‡è¦–ã—ã€ã™ãã«å®Ÿè·µã§ãã‚‹å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„
- æ „é¤Šç´ ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹ç›¸ä¹—åŠ¹æœã‚‚è€ƒæ…®ã—ã¦ãã ã•ã„
`;
};

// é£Ÿã¹ç‰©ä»¥å¤–ã®ç‰©ä½“ã«å¯¾ã™ã‚‹ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
const NON_FOOD_MESSAGES = {
  person: [
    "ãˆï¼ï¼ã“ã‚Œã¯äººé–“...ã§ã™ã‚ˆã­ï¼Ÿï¼Ÿã¾ã•ã‹é£Ÿã¹ã¦ãªã„ã§ã™ã‚ˆã­...",
    "äººé–“ã¯ç¾å®¹é£Ÿæã§ã¯ã‚ã‚Šã¾ã›ã‚“ã‚ˆï¼ğŸ˜…",
    "ãŠå‹é”ã®å†™çœŸã§ã™ã‹ï¼Ÿç¾å®¹åŠ¹æœã¯...æ¸¬å®šä¸èƒ½ã§ã™ï¼"
  ],
  animal: [
    "çŒ«ã¡ã‚ƒã‚“ã¯åˆ¤å®šã§ãã¾ã›ã‚“ã‚ˆï¼ğŸ±",
    "ã‚ã‚“ã¡ã‚ƒã‚“ã¯å¯æ„›ã„ã§ã™ãŒã€ç¾å®¹ã‚¹ã‚³ã‚¢ã¯å‡ºã›ã¾ã›ã‚“ï¼ğŸ•",
    "å‹•ç‰©ã•ã‚“ã®ç¾å®¹åŠ¹æœã¯...æ„›ã§ã‚‹ã“ã¨ã§ã—ã‚‡ã†ã‹ï¼ŸğŸ’•"
  ],
  electronics: [
    "ãƒ‘ã‚½ã‚³ãƒ³ã¯å›ºãã¦é£Ÿã¹ã‚‹ã®ã«ã¯å‘ã„ã¦ã¾ã›ã‚“ã­...",
    "ã‚¹ãƒãƒ›ã®ã‚«ãƒ­ãƒªãƒ¼ã¯0kcalã§ã™ãŒã€æ „é¤Šä¾¡ã‚‚0ã§ã™ğŸ“±",
    "é›»å­æ©Ÿå™¨ã®ç¾å®¹åŠ¹æœã¯...ãƒ–ãƒ«ãƒ¼ãƒ©ã‚¤ãƒˆã‚«ãƒƒãƒˆã§ã—ã‚‡ã†ã‹ï¼Ÿ"
  ],
  furniture: [
    "æ¤…å­ã¯åº§ã‚‹ã‚‚ã®ã§ã‚ã£ã¦ã€é£Ÿã¹ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼",
    "ãƒ†ãƒ¼ãƒ–ãƒ«ã®æœ¨æã¯é£Ÿç‰©ç¹Šç¶­è±Šå¯Œã§ã™ãŒ...ãŠã™ã™ã‚ã—ã¾ã›ã‚“ğŸ˜…",
    "å®¶å…·ã®ç¾å®¹åŠ¹æœã¯ã€ãŠéƒ¨å±‹ãŒç¶ºéº—ã«ãªã‚‹ã“ã¨ã§ã—ã‚‡ã†ã‹ï¼Ÿ"
  ],
  vehicle: [
    "è»Šã¯é‰„åˆ†è±Šå¯Œã§ã™ãŒã€æ¶ˆåŒ–ã«æ‚ªãã†ã§ã™ğŸš—",
    "è‡ªè»¢è»Šã®ã‚«ãƒ­ãƒªãƒ¼æ¶ˆè²»åŠ¹æœã¯ã‚ã‚Šã¾ã™ãŒã€é£Ÿã¹ç‰©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼",
    "ä¹—ã‚Šç‰©ã®ç¾å®¹åŠ¹æœã¯...ç§»å‹•ã«ã‚ˆã‚‹é‹å‹•ã§ã—ã‚‡ã†ã‹ï¼Ÿ"
  ],
  nature: [
    "ãŠèŠ±ã¯ç¾ã—ã„ã§ã™ãŒã€é£Ÿç”¨èŠ±ã§ãªã„é™ã‚Šç¾å®¹è§£æã§ãã¾ã›ã‚“ğŸŒ¸",
    "æœ¨ã‚„çŸ³ã®ç¾å®¹åŠ¹æœã¯...è‡ªç„¶ã«ç™’ã•ã‚Œã‚‹ã“ã¨ã§ã—ã‚‡ã†ã‹ï¼Ÿ",
    "æ™¯è‰²ã¯å¿ƒã®æ „é¤Šã«ãªã‚Šã¾ã™ãŒã€ã‚«ãƒ­ãƒªãƒ¼è¨ˆç®—ã¯ã§ãã¾ã›ã‚“ï¼"
  ],
  object: [
    "ã“ã‚Œã¯...é£Ÿã¹ç‰©ã§ã¯ãªã„ã‚ˆã†ã§ã™ã­ï¼ŸğŸ¤”",
    "ç¾å®¹è§£æã«ã¯é£Ÿäº‹ã®å†™çœŸãŒå¿…è¦ã§ã™ï¼",
    "ã“ã®ç‰©ä½“ã®æ „é¤Šä¾¡ã¯...æ¸¬å®šä¸èƒ½ã§ã™ï¼"
  ],
  unclear: [
    "ã†ã€œã‚“ã€ã“ã‚ŒãŒä½•ãªã®ã‹ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ğŸ¤·â€â™€ï¸",
    "ã‚‚ã—ã‹ã—ã¦ã€ã¨ã¦ã‚‚çã—ã„é£Ÿæã§ã—ã‚‡ã†ã‹ï¼Ÿ",
    "ç”»åƒãŒã¼ã‚„ã‘ã¦ã„ã‚‹ã‹ã€é£Ÿã¹ç‰©ä»¥å¤–ã®ã‚ˆã†ã§ã™"
  ]
};

// é£Ÿã¹ç‰©åˆ¤å®šç”¨ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
export const createFoodDetectionPrompt = () => {
  return `
ã“ã®ç”»åƒã‚’è¦‹ã¦ã€é£Ÿã¹ç‰©ï¼ˆé£Ÿäº‹ã€æ–™ç†ã€é£Ÿæã€é£²ã¿ç‰©ã€ãŠè“å­ãªã©ï¼‰ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚’åˆ¤å®šã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã®JSONå½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„:

{
  "is_food": true/false,
  "detected_object": "person|animal|electronics|furniture|vehicle|nature|object|unclear",
  "confidence": 0.95,
  "description": "ç”»åƒã«å†™ã£ã¦ã„ã‚‹ã‚‚ã®ã®ç°¡æ½”ãªèª¬æ˜ï¼ˆæ—¥æœ¬èªï¼‰"
}

åˆ¤å®šåŸºæº–:
- is_food: true = é£Ÿã¹ç‰©ã€æ–™ç†ã€é£Ÿæã€é£²ã¿ç‰©ã€ãŠè“å­ãªã©é£Ÿäº‹ã«é–¢é€£ã™ã‚‹ã‚‚ã®
- is_food: false = äººã€å‹•ç‰©ã€é›»å­æ©Ÿå™¨ã€å®¶å…·ã€ä¹—ã‚Šç‰©ã€è‡ªç„¶ã€ãã®ä»–ã®ç‰©ä½“

detected_object ã®åˆ†é¡:
- person: äººé–“ã€é¡”ã€ä½“ã®ä¸€éƒ¨
- animal: å‹•ç‰©ã€ãƒšãƒƒãƒˆã€æ˜†è™«ãªã©
- electronics: ã‚¹ãƒãƒ›ã€ãƒ‘ã‚½ã‚³ãƒ³ã€ãƒ†ãƒ¬ãƒ“ã€é›»å­æ©Ÿå™¨
- furniture: æ¤…å­ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒ™ãƒƒãƒ‰ã€å®¶å…·
- vehicle: è»Šã€è‡ªè»¢è»Šã€é›»è»Šã€ä¹—ã‚Šç‰©
- nature: èŠ±ã€æœ¨ã€çŸ³ã€é¢¨æ™¯ã€è‡ªç„¶ç‰©
- object: ãã®ä»–ã®ç‰©ä½“ã€é“å…·ã€å»ºç‰©ãªã©
- unclear: åˆ¤åˆ¥å›°é›£ã€ã¼ã‚„ã‘ã¦ã„ã‚‹ã€æš—ã„

é‡è¦: æœ‰åŠ¹ãªJSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚
`;
};

// é£Ÿã¹ç‰©ä»¥å¤–ã®å ´åˆã®ãƒ¦ãƒ¼ãƒ¢ãƒ©ã‚¹ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ
export const generateNonFoodResponse = (detectedObject: string): any => {
  const category = detectedObject as keyof typeof NON_FOOD_MESSAGES;
  const messages = NON_FOOD_MESSAGES[category] || NON_FOOD_MESSAGES.object;
  const randomMessage = messages[Math.floor(Math.random() * messages.length)];
  
  return {
    is_food: false,
    detected_object: detectedObject,
    humorous_message: randomMessage,
    suggestion: "ç¾å®¹åŠ¹æœã‚’åˆ†æã™ã‚‹ã«ã¯ã€é£Ÿäº‹ã‚„é£Ÿæã®å†™çœŸã‚’æ’®å½±ã—ã¦ãã ã•ã„ã­ï¼ğŸ“¸âœ¨",
    detected_foods: [],
    nutrition_analysis: {
      calories: 0,
      protein: 0,
      carbohydrates: 0,
      fat: 0,
      fiber: 0,
      vitamins: {
        vitamin_c: 0,
        vitamin_e: 0,
        vitamin_a: 0,
        vitamin_b_complex: 0
      },
      minerals: {
        iron: 0,
        zinc: 0,
        calcium: 0,
        magnesium: 0
      }
    },
    beauty_score: {
      skin_care: 0,
      anti_aging: 0,
      detox: 0,
      circulation: 0,
      hair_nails: 0,
      overall: 0
    },
    immediate_advice: "ã¾ãšã¯é£Ÿäº‹ã®å†™çœŸã‚’æ’®å½±ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼",
    next_meal_advice: "æ¬¡å›ã¯ç¾å‘³ã—ãã†ãªæ–™ç†ã®å†™çœŸã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ğŸ½ï¸",
    beauty_benefits: [
      "é£Ÿäº‹ã®å†™çœŸã‚’æ’®ã‚‹ã“ã¨ã§ã€é£Ÿç”Ÿæ´»ã¸ã®æ„è­˜ãŒé«˜ã¾ã‚Šã¾ã™",
      "ç¾å®¹ã«è‰¯ã„é£Ÿæã‚’æ„è­˜çš„ã«é¸ã¶ãã£ã‹ã‘ã«ãªã‚Šã¾ã™",
      "æ „é¤Šãƒãƒ©ãƒ³ã‚¹ã‚’è€ƒãˆã‚‹ç¿’æ…£ãŒèº«ã«ã¤ãã¾ã™"
    ]
  };
};

// ç”»åƒã‚’Base64ã«å¤‰æ›ã™ã‚‹é–¢æ•°
const convertImageToBase64 = async (imageUri: string): Promise<string> => {
  try {
    if (imageUri.startsWith('data:')) {
      // æ—¢ã«Base64ã®å ´åˆã¯ãã®ã¾ã¾è¿”ã™
      return imageUri;
    }
    
    // React Nativeã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã—ã¦Base64å¤‰æ›
    const FileSystem = await import('expo-file-system');
    const base64 = await FileSystem.readAsStringAsync(imageUri, {
      encoding: FileSystem.EncodingType.Base64,
    });
    return `data:image/jpeg;base64,${base64}`;
  } catch (error) {
    console.error('Base64å¤‰æ›ã‚¨ãƒ©ãƒ¼:', error);
    throw new Error('ç”»åƒã®å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
};

// é£Ÿã¹ç‰©åˆ¤å®šã‚’è¡Œã†é–¢æ•°
export const detectFoodInImage = async (imageUri: string): Promise<{
  isFood: boolean;
  detectedObject?: string;
  confidence?: number;
  description?: string;
}> => {
  try {
    console.log('OpenAIé£Ÿã¹ç‰©åˆ¤å®šAPIå‘¼ã³å‡ºã—é–‹å§‹');
    
    // ç”»åƒã‚’Base64ã«å¤‰æ›
    const base64Image = await convertImageToBase64(imageUri);
    console.log('Base64å¤‰æ›å®Œäº†');
    
    const response = await openai.chat.completions.create({
      model: "gpt-4o-mini",
      messages: [
        {
          role: "system",
          content: "ã‚ãªãŸã¯ç”»åƒåˆ¤å®šã®å°‚é–€å®¶ã§ã™ã€‚å¿…ãšæœ‰åŠ¹ãªJSONå½¢å¼ã§ã®ã¿å›ç­”ã—ã¦ãã ã•ã„ã€‚Markdownã‚„ãã®ä»–ã®å½¢å¼ã¯ä½¿ç”¨ã›ãšã€ç´”ç²‹ãªJSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚"
        },
        {
          role: "user",
          content: [
            {
              type: "text",
              text: createFoodDetectionPrompt()
            },
            {
              type: "image_url",
              image_url: {
                url: base64Image,
              },
            },
          ],
        },
      ],
      max_tokens: 200,
      response_format: { type: "json_object" }
    });

    const content = response.choices[0]?.message?.content;
    if (!content) {
      throw new Error('OpenAI API response is empty');
    }

    console.log('OpenAIé£Ÿã¹ç‰©åˆ¤å®šAPIç”Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹:', content);
    
    // Markdownã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»
    let cleanedContent = content.trim();
    if (cleanedContent.startsWith('```json')) {
      cleanedContent = cleanedContent.replace(/^```json\s*/, '').replace(/\s*```$/, '');
    } else if (cleanedContent.startsWith('```')) {
      cleanedContent = cleanedContent.replace(/^```\s*/, '').replace(/\s*```$/, '');
    }
    
    console.log('ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°å¾Œã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', cleanedContent);
    const result = JSON.parse(cleanedContent);
    console.log('ãƒ‘ãƒ¼ã‚¹å¾Œã®åˆ¤å®šçµæœ:', result);
    
    return {
      isFood: result.is_food,
      detectedObject: result.detected_object,
      confidence: result.confidence,
      description: result.description
    };
    
  } catch (error) {
    console.error('Food detection error:', error);
    // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯é£Ÿã¹ç‰©ä»¥å¤–ã¨ã—ã¦å‡¦ç†ï¼ˆå®‰å…¨å´ã«å€’ã™ï¼‰
    return {
      isFood: false,
      detectedObject: 'unclear',
      confidence: 0.5,
      description: 'åˆ¤å®šã§ãã¾ã›ã‚“ã§ã—ãŸ'
    };
  }
};

export default openai; 